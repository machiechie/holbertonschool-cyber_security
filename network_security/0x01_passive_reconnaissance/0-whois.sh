#!/bin/bash
whois $1 | awk -F': +' 'BEGIN{split("Registrant,Admin,Tech",g,",");split("Name,Organization,Street,City,State/Province,Postal Code,Country,Phone,Phone Ext:,Fax,Fax Ext:,Email",s,",")} {k=$1;sub(/^Registry /,"",k);sub(/[ \t]+$/,"",k);if(!(k in d))d[k]=$2} END{for(i=1;i<=3;i++)for(j=1;j<=12;j++){f=g[i]" "s[j];v=d[f];sub(/[ \t]+$/,"",v);if(s[j]=="Street"&&v!="")v=v" ";if(s[j]~/Ext:/)v="";printf "%s,%s\n",f,v}}' > $1.csv
